<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.aloha.security.mapper.BoardMapper">

	<resultMap id="boardMap" type="Board">
        <id property="no" column="no"/>     <!-- PK -->
        <result property="id" column="id"/>
        <result property="title" column="title"/>
        <result property="userNo" column="user_no"/>
        <result property="content" column="content"/>
        <result property="createdAt" column="created_at"/>
        <result property="updatedAt" column="updated_at"/>

		<!-- 1:N 매핑 = association -->
		<association property="user" select="selectUser" column="user_no" javaType="Users"/>
    </resultMap>

	<select id="selectUser" resultType="Users">
		SELECT *
		FROM user
		WHERE no = #{user_no}
	</select>

	<!-- 목록 -->
	<!-- <select id="list" resultType="Board"> -->
	<select id="list" resultMap="boardMap">
		SELECT *
		FROM board
		ORDER BY no DESC, created_at DESC
	</select>

	<!-- 조회 -->
	<!-- <select id="select" resultType="Board"> -->
	<select id="select" resultMap="boardMap">
		SELECT *
		FROM board
		WHERE no = #{no}
	</select>

	<!-- 조회 -->
	<!-- <select id="selectById" resultType="Board" > -->
	<select id="selectById" resultMap="boardMap" >
		SELECT *
		FROM board
		WHERE id = #{id}
	</select>

	<!-- 등록 -->
	<insert id="insert">
		INSERT INTO board ( id, title, user_no, content )
		VALUES ( #{id}, #{title}, #{userNo}, #{content})
	</insert>

	<!-- 수정 -->
	<update id="update">
		UPDATE board
			<set>
		   		<if test="title != null and title != ''">
				title = #{title},
				</if>
			</set>
			<set>
		   		<if test="content != null and content != ''">
				content = #{content},
				</if>
			</set>
		WHERE no = #{no}
	</update>

	<!-- 수정 -->
	<update id="updateById">
		UPDATE board
			<set>
		   		<if test="title != null and title != ''">
				title = #{title},
				</if>
			</set>
			<set>
		   		<if test="content != null and content != ''">
				content = #{content},
				</if>
			</set>
		WHERE id = #{id}
	</update>

	<!-- 삭제 -->
	<delete id="delete">
		DELETE FROM board
		WHERE no = #{no}
	</delete>
	
	<!-- 삭제 -->
	<delete id="deleteById">
		DELETE FROM board
		WHERE id = #{id}
	</delete>
	
</mapper>