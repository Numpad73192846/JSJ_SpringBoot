<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>jQuery</title>
</head>
<body>
	<h1>jQuery</h1>

	<h5>게시글 조회</h5>
	<label for="no">게시글 번호</label>
	<input type="text" name="no" id="no">
	<button onclick="getBoard()">조회</button>
	<hr>

	<div>
		<h5>조회된 게시글 정보</h5>
		<h3><span>제목 : </span><span id="title"></span></h3>
		<h3><span>작성자 : </span><span id="writer"></span></h3>
		<textarea id="content" cols="50" rows="10" readonly></textarea>
	</div>

	<hr>

	<h3>게시글 등록/수정/삭제</h3>
	<form action="api/boards" method="post">
		<table>
			<tr>
				<td><label for="title">제목</label></td>
				<td><input type="text" name="title" id="input-title"></td>
			</tr>
			<tr>
				<td><label for="writer">작성자</label></td>
				<td><input type="text" name="writer" id="input-writer"></td>
			</tr>
			<tr>
				<td><label for="content">내용</label></td>
				<td>
					<textarea name="content" id="input-content" cols="50" rows="10"></textarea>
				</td>
			</tr>
			<tr>
				<td><label for="updateNo">글번호</label></td>
				<td><input type="text" name="no" id="input-no" placeholder="수정/삭제 번호"></td>
			</tr>
		</table>
		<button type="button" onclick="insert()">등록하기</button>
		<button type="button" onclick="update()">수정하기</button>
		<button type="button" onclick="remove()">삭제하기</button>
	</form>


	<hr>

	<h3>게시글 목록</h3>
	<table id="board-list" border="1">
		<tr id="board-title">
			<th width="50">번호</th>
			<th width="300">제목</th>
			<th width="100">작성자</th>
			<th width="200">등록일자</th>
			<th width="200">수정일자</th>
		</tr>
		<tbody id="board-body">
			<tr id="board-data">
				<td colspan="5" align="center">조회된 데이터가 없습니다.</td>
			</tr>
		</tbody>
	</table>

	<!-- jQuery CDN -->
	<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
	<script>
		let request
		// 게시글 조회
		function getBoard() {
			// 입력한 글 번호 가져오기
			let no = $("#no").val()
			
			// 요청 설정
			let url = `http://127.0.0.1:8080/api/boards/${no}`
			
			// jQuery AJAX 로 게시글 조회요청
			$.ajax({
				url 		: url,
				method 		: 'GET',
				dataType	: 'json',
				success		: function(board) {
					if ( !board ) {
						alert('응답된 데이터가 없습니다.')
					}
					else {
						$('#title').text(board.title)
						$('#writer').text(board.writer)
						$('#content').text(board.content)
					}
				},
				error		: function(xhr, status, error) {
					console.error('Error : ', error)
					alert('데이터 조회에 실패했습니다.')
				}
			})

		}

		// 게시글 조회
		function getList() {
			// 요청 설정
			let url = `http://127.0.0.1:8080/api/boards`

			// jQuery AJAX 로 게시글 목록 요청
			$.ajax({
				url 		: url,
				method 		: 'GET',
				dataType	: 'json',
				success		: function(boardList) {
					if ( boardList.length == 0 ) {
						alert('응답된 데이터가 없습니다.')
					}
					else {
						// 데이터 초기화
						$('#board-body').empty()

						let tr = ''
						for(const board of boardList) {
							tr += `<tr>
									   <td>${board.no}</td>
									   <td>${board.title}</td>
									   <td>${board.writer}</td>
									   <td>${board.createdAt}</td>
									   <td>${board.updatedAt}</td>
								   </tr>`
						}
						$('#board-body').html(tr)
					}
				},
				error		: function(xhr, status, error) {
					console.error('Error : ', error)
					alert('데이터 조회에 실패했습니다.')
				}
			})

		}
		// 게시글 목록 함수 호출
		getList()

		// 게시글 등록
		function insert() {
			// 입력정보
			let title = $("#input-title").val()
			let writer = $("#input-writer").val()
			let content = $("#input-content").val()

			// 객체
			let data = {
				'title' : title,
				'writer' : writer,
				'content' : content,
			}

			// 요청 설정
			let url = `http://127.0.0.1:8080/api/boards`

			// jQuery AJAX 로 게시글 등록 요청
			$.ajax({
				url 		: url,
				method		: 'POST',
				contentType	: 'application/json',
				data		: JSON.stringify(data),
				success		: function(result, status, xhr) {
					alert(result)
					getList()
				},
				error		: function(xhr, status, error) {
					if ( xhr.status == 400 ) {
						alert('클라이언트의 잘못된 요청')
					}
					else if ( xhr.status == 500 ) {
						alert('서버 내부 에러')
					}
					else {
						console.error('Error : ', error)
						alert('게시글 등록 중 에러가 발생하였습니다.')
					}
				}
			})
		}

		// 게시글 수정
		function update() {
			// 입력 정보
			let no = $("#input-no").val()
			let title = $("#input-title").val()
			let writer = $("#input-writer").val()
			let content = $("#input-content").val()

			// 객체
			let data = {
				'no' : no,
				'title' : title,
				'writer' : writer,
				'content' : content
			}

			// 요청 설정
			let url = `http://127.0.0.1:8080/api/boards`

			// jQuery AJAX 로 게시글 수정 요청
			$.ajax({
				url 		: url,
				method		: 'PUT',
				contentType	: 'application/json',
				data		: JSON.stringify(data),
				success		: function(result, status, xhr) {
					alert(result)
					getList()
				},
				error		: function(xhr, status, error) {
					if ( xhr.status == 400 ) {
						alert('클라이언트의 잘못된 요청')
					}
					else if ( xhr.status == 500 ) {
						alert('서버 내부 에러')
					}
					else {
						console.error('Error : ', error)
						alert('게시글 수정 중 에러가 발생하였습니다.')
					}
				}
			})

		}

		// 게시글 삭제
		function remove() {
			// 입력 정보
			let no = $("#input-no").val()

			// DELETE 요청 방식은 요청 데이터를 URL 에 포함하여 전송한다
			// 요청 설정
			let url = `http://127.0.0.1:8080/api/boards/${no}`

			// jQuery AJAX 로 게시글 삭제 요청
			$.ajax({
				url 		: url,
				method		: 'DELETE',
				success		: function(result, status, xhr) {
					alert(result)
					getList()
				},
				error		: function(xhr, status, error) {
					if ( xhr.status == 400 ) {
						alert('클라이언트의 잘못된 요청')
					}
					else if ( xhr.status == 500 ) {
						alert('서버 내부 에러')
					}
					else {
						console.error('Error : ', error)
						alert('게시글 삭제 중 에러가 발생하였습니다.')
					}
				}
			})

		}
		</script>
</body>
</html>